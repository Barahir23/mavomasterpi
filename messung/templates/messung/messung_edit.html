<form method="post" action="{% if selected_messung %}{% url 'messung_edit' selected_messung.id %}{% else %}{% url 'messung_create' selected_objekt.id %}{% endif %}" class="edit-form" id="messung-edit-form" data-create-url="{% url 'messung_create' selected_objekt.id %}">
  {% csrf_token %}
  <input type="hidden" name="messdaten" id="messdaten-input">
  <div class="form-header">
    <span class="form-title">Messung</span>
    <select id="messung-select">
      <option value=""{% if not selected_messung %} selected{% endif %}>Messung wählen</option>
      {% for messung in messungen %}
      <option value="{{ messung.id }}"{% if selected_messung and messung.id == selected_messung.id %} selected{% endif %}>{{ messung.name }}</option>
      {% endfor %}
    </select>
    <div class="form-actions">
      <button type="button" class="icon-btn new-btn" title="Neue Messung">
        <span class="icon">{% include "icons/document-plus.svg" %}</span>
      </button>
      <button type="submit" class="icon-btn save-btn" title="Speichern" disabled>
        <span class="icon">{% include "icons/folder-arrow-down.svg" %}</span>
      </button>
      <button type="button" class="icon-btn accordion-toggle" data-target="#messung-fields" title="Minimieren">
        <span class="icon">{% include "icons/chevron-up.svg" %}</span>
      </button>
    </div>
  </div>
  <div id="messung-fields" class="accordion-body">
    <div class="form-row">
      {{ messung_form.name.label_tag }} {{ messung_form.name }}
    </div>
    <div class="form-row">
      {{ messung_form.anforderung.label_tag }}
      <input type="hidden" name="anforderung" id="id_anforderung" value="{{ messung_form.anforderung.value|default:'' }}">
      <button type="button" class="icon-btn" id="anforderung-open" title="Anforderung wählen">
        <span class="icon">{% include "icons/magnifying-glass.svg" %}</span>
      </button>
      <span id="anforderung-display">
        {% if selected_messung and selected_messung.anforderung %}
          {{ selected_messung.anforderung.ref }}{% if selected_messung.anforderung.typ %} {{ selected_messung.anforderung.typ }}{% endif %}
        {% else %}–{% endif %}
      </span>
    </div>
    <div class="form-row">
      {{ messung_form.messbedingungen.label_tag }} {{ messung_form.messbedingungen }}
    </div>
    <div class="form-row">
      {{ messung_form.messhoehe.label_tag }} {{ messung_form.messhoehe }}
    </div>
  </div>
</form>

<div id="anforderung-modal" class="mm-modal" aria-hidden="true">
  <div class="mm-modal__backdrop" data-mm-close></div>
  <div class="mm-modal__dialog" role="dialog" aria-modal="true" aria-labelledby="anforderung-modal-title">
    <h3 id="anforderung-modal-title" class="mm-modal__title">Anforderungen</h3>
    <input type="text" id="anforderung-search" placeholder="Suche...">
    <div id="anforderung-results"></div>
    <div class="mm-modal__actions">
      <button type="button" id="anforderung-close" class="mm-btn mm-btn--primary" data-mm-close>Schließen</button>
    </div>
  </div>
</div>
