{% extends "layout.html" %}
{% block title %}Projekte – MavoMaster{% endblock %}
{% block sidebar_context %}
  <nav class="sidebar-nav always-visible">
    <a href="{% url 'projekt_add' %}" class="nav-item" title="Projekt hinzufügen">
      <span class="icon">{% include "icons/folder-plus.svg" %}</span><span class="label">Projekt hinzufügen</span>
    </a>
    {% if selected_projekt %}
      <a href="{% url 'objekt_add_project' selected_projekt.id %}" class="nav-item" title="Objekt hinzufügen">
        <span class="icon">{% include "icons/document-plus.svg" %}</span><span class="label">Objekt hinzufügen</span>
      </a>
    {% endif %}
    {% if selected_objekt %}
      <a href="{% url 'messung:page' %}?objekt={{ selected_objekt.id }}" class="nav-item" title="Messung hinzufügen">
        <span class="icon">{% include "icons/document-plus.svg" %}</span><span class="label">Messung hinzufügen</span>
      </a>
    {% endif %}
  </nav>
  {% if selected_projekt %}
    {% include "messung/projek_edit.html" %}
  {% endif %}
  {% if selected_objekt %}
    {% include "messung/objekt_edit.html" %}
  {% endif %}
  {% if selected_messung %}
    {% include "messung/messung_edit.html" %}
  {% endif %}
{% endblock %}
{% block content %}
  <div class="projekt-columns">
    <div class="column">
      {% for projekt in projekte %}
        <a href="{% url 'projekte_page' %}?projekt={{ projekt.id }}">
          <section class="card projekt-card{% if selected_projekt and projekt.id == selected_projekt.id %} selected{% endif %}">
            <h3>{{ projekt.code }} {{ projekt.name }}</h3>
          </section>
        </a>
      {% empty %}
        <section class="card"><p>Keine Projekte vorhanden.</p></section>
      {% endfor %}
    </div>
    <div class="column">
      {% if selected_projekt %}
        {% for objekt in objekte %}
          <a href="{% url 'projekte_page' %}?projekt={{ selected_projekt.id }}&objekt={{ objekt.id }}">
            <section class="card objekt-card{% if selected_objekt and objekt.id == selected_objekt.id %} selected{% endif %}">
              <h4>{{ objekt.name }}</h4>
            </section>
          </a>
        {% empty %}
          <section class="card"><p>Keine Objekte vorhanden.</p></section>
        {% endfor %}
      {% endif %}
    </div>
    <div class="column">
      {% if selected_objekt %}
        {% for messung in messungen %}
          <a href="{% url 'projekte_page' %}?projekt={{ selected_projekt.id }}&objekt={{ selected_objekt.id }}&messung={{ messung.id }}">
            <section class="card{% if selected_messung and messung.id == selected_messung.id %} selected{% endif %}">
              <h4>{{ messung.name }}</h4>
            </section>
          </a>
        {% empty %}
          <section class="card"><p>Keine Messungen vorhanden.</p></section>
        {% endfor %}
      {% endif %}
    </div>
  </div>
{% endblock %}
{% block extra_js %}
{% if selected_projekt or selected_objekt or selected_messung %}
<script>
  document.documentElement.classList.remove('sidebar-collapsed');
  document.body.classList.remove('sidebar-collapsed');
  try { localStorage.setItem('mm.sidebar.collapsed','0'); } catch(e){}
</script>
{% endif %}
{% endblock %}
