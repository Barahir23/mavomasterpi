{% extends "layout.html" %}
{% load static %}
{% block title %}Messung – MavoMaster{% endblock %}
{% block extra_css %}
  <link rel="stylesheet" href="{% static 'css/messung.css' %}">
{% endblock %}
{% block sidebar_context %}
  <div class="device-connection">
    <button type="button" class="icon-btn" id="device-connect" title="Messgerät verbinden">
      <span class="icon">{% include "icons/arrow-path-rounded-square.svg" %}</span>
    </button>
    <span id="device-status">{{ device_status }}</span>
  </div>
  <form id="selection-form" class="edit-form" method="get">
    <div class="form-row">
      <label for="project-select">Projektauswahl</label>
      <select id="project-select" name="projekt">
        <option value="">– bitte wählen –</option>
        {% for projekt in projekte %}
          <option value="{{ projekt.id }}"{% if selected_projekt and projekt.id == selected_projekt.id %} selected{% endif %}>{{ projekt.name }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="form-row">
      <label for="object-select">Objektauswahl</label>
      <select id="object-select" name="objekt"{% if not objekte %} disabled{% endif %}>
        <option value="">– bitte wählen –</option>
        {% for objekt in objekte %}
          <option value="{{ objekt.id }}"{% if selected_objekt and objekt.id == selected_objekt.id %} selected{% endif %}>{{ objekt.name }}</option>
        {% endfor %}
      </select>
    </div>
  </form>
  {% if selected_messung %}
    {% include "messung/messung_edit.html" %}
  {% endif %}
{% endblock %}
{% block content %}
  <section class="card measurement-card">
    <div class="measurement-main">
      <button type="button" class="icon-btn" id="single-measure" title="Einzelmessung">
        <span class="icon">{% include "icons/camera.svg" %}</span>
      </button>
      <span id="realtime-value">0.00</span>
    </div>
    <div class="measurement-controls">
      <button type="button" class="icon-btn" id="sequence-start" title="Messsequenz starten">
        <span class="icon">{% include "icons/play.svg" %}</span>
      </button>
      <button type="button" class="icon-btn" id="sequence-stop" title="Messsequenz stoppen">
        <span class="icon">{% include "icons/stop.svg" %}</span>
      </button>
      <select id="sequence-select"></select>
      <button type="button" class="icon-btn" id="sequence-add" title="Neue Messsequenz">
        <span class="icon">{% include "icons/document-plus.svg" %}</span>
      </button>
      <label for="sequence-interval">Intervall (s)</label>
      <input type="number" id="sequence-interval" min="1" max="10" value="5">
      <label for="sequence-count">Anzahl</label>
      <input type="number" id="sequence-count" min="2" max="1000" value="5">
      <span id="sequence-duration"></span>
    </div>
  </section>

  <section class="card">
    <table class="measurement-table">
      <thead>
        <tr>
          <th>Zeit</th>
          <th>Einzelmessung</th>
          <th class="comment-column"><button type="button" class="comment-toggle" data-index="0">Kommentar</button></th>
          <th class="delete-column"></th>
        </tr>
      </thead>
      <tbody id="measurement-table-body"></tbody>
    </table>
  </section>
  <div id="sequence-overlay"><span id="sequence-countdown"></span></div>
{% endblock %}
{% block extra_js %}
  <script>
    window.initialTable = {{ initial_table|safe }};
  </script>
  <script src="{% static 'js/messung.js' %}"></script>
{% endblock %}
