{% extends "layout.html" %}
{% load static %}
{% block title %}Messung – MavoMaster{% endblock %}
{% block extra_css %}
  <link rel="stylesheet" href="{% static 'css/messung.css' %}">
{% endblock %}
{% block sidebar_context %}
  <div class="device-connection">
    <button type="button" class="icon-btn" id="device-connect" title="Messgerät verbinden">
      <span class="icon">{% include "icons/arrow-path-rounded-square.svg" %}</span>
    </button>
    <span id="device-status">{{ device_status }}</span>
  </div>
  <form id="selection-form" class="edit-form" method="get">
    <div class="form-row">
      <label for="project-select">Projektauswahl</label>
      <select id="project-select" name="projekt" onchange="this.form.submit()">
        <option value="">– bitte wählen –</option>
        {% for projekt in projekte %}
          <option value="{{ projekt.id }}"{% if selected_projekt and projekt.id == selected_projekt.id %} selected{% endif %}>{{ projekt.name }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="form-row">
      <label for="object-select">Objektauswahl</label>
      <select id="object-select" name="objekt" onchange="this.form.submit()"{% if not objekte %} disabled{% endif %}>
        <option value="">– bitte wählen –</option>
        {% for objekt in objekte %}
          <option value="{{ objekt.id }}"{% if selected_objekt and objekt.id == selected_objekt.id %} selected{% endif %}>{{ objekt.name }}</option>
        {% endfor %}
      </select>
    </div>
  </form>
  {% if selected_messung %}
    {% include "messung/messung_edit.html" %}
    <div class="card" id="sidebar-stats">
      <h3>Statuswerte</h3>
      {% include "stats_table.html" %}
    </div>
  {% endif %}
{% endblock %}
{% block content %}
  <section class="card measurement-card">
    <div class="controls-row">
      <div class="controls-left">
        <select id="sequence-select"></select>
        <button type="button" class="icon-btn" id="sequence-add" title="Neue Messreihe">
          <span class="icon">{% include "icons/document-plus.svg" %}</span>
        </button>
      </div>
      <div class="controls-center">
        <div class="measurement-main">
          <button type="button" class="icon-btn" id="single-measure" title="Einzelmessung">
            <span class="icon">{% include "icons/camera.svg" %}</span>
          </button>
          <span id="realtime-value">0.00</span>
        </div>
        <div class="control-group">
          <div class="control-buttons">
            <button type="button" class="icon-btn" id="sequence-start" title="Messreihe starten">
              <span class="icon">{% include "icons/play.svg" %}</span>
            </button>
            <button type="button" class="icon-btn" id="sequence-stop" title="Messreihe stoppen">
              <span class="icon">{% include "icons/stop.svg" %}</span>
            </button>
          </div>
          <span id="sequence-duration"></span>
        </div>
      </div>
      <div class="controls-right">
        <div class="range-group">
          <label for="sequence-interval">Intervall (s): <span id="sequence-interval-display">5</span></label>
          <input type="range" id="sequence-interval" min="1" max="10" value="5">
        </div>
        <div class="range-group">
          <label for="sequence-count">Anzahl: <span id="sequence-count-display">5</span></label>
          <input type="range" id="sequence-count" min="2" max="1000" value="5">
        </div>
      </div>
    </div>
  </section>

  <section class="card">
    {% include "measurement_table.html" with show_comments=show_comments %}
  </section>
  <div id="sequence-overlay"><span id="sequence-countdown"></span></div>
  {# Stats context menu #}
  {% include "context_stats_menu.html" %}
{% endblock %}
{% block extra_js %}
  {{ initial_table|json_script:"initial-table" }}
  {{ anforderungen_list|json_script:"anforderungen-data" }}
  <script src="{% static 'js/NoSleep.min.js' %}"></script>
  <script type="module" src="{% static 'js/messung.js' %}"></script>
{% endblock %}
